

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ol-kit | LayerPanel/LayerPanelLayersPage/index.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densityDpi=device-dpi" />


    <!-- these scripts must be at the top to properly syntax highlight code examples -->
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js" integrity="sha256-FiZMk1zgTeujzf/+vomWZGZ9r00+xnGvOgXoj0Jo1jA=" crossorigin="anonymous"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.css">
    <link type="text/css" rel="stylesheet" href="styles/iframe.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                    <a href="index.html"><img src="static/ol-kit-logo.png" alt="logo"></a>
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                 
                <div class="navbar-menu">
                    <div class="navbar-end">
                    
                        <div class="navbar-item">
                            <a href="tutorial-Getting%20Started.html">
                                Get Started
                            </a>
                        </div>
                    
                        <div class="navbar-item">
                            <a href="docs.html">
                                Docs
                            </a>
                        </div>
                    
                        <div class="navbar-item">
                            <a href="https://github.com/Bayer-Group/ol-kit">
                                Github
                            </a>
                        </div>
                    
                    </div>
                </div>
                
            </nav>
        </div>
    </div>
    <div id="page-wrapper" class="container">
        <div class="columns">
            <div class="column is-3" id="sidebar-nav">
                <div class="sidebar sidebar__inner">
                    <nav>
                        <div class="category"><h3>Tutorials</h3><ul><li><a class="undefined"href="tutorial-Getting Started.html">Getting Started</a></li><li><a class="undefined"href="tutorial-LayerPanel_.html">LayerPanel</a></li><li><a class="undefined"href="tutorial-Popup_.html">Popup</a></li><li><a class="undefined"href="tutorial-TimeSlider_.html">TimeSlider</a></li><li><a class="undefined"href="tutorial-connectToContext.html">connectToContext</a></li><li><a class="undefined"href="tutorial-contextProps.html">contextProps</a></li><li><a class="undefined"href="tutorial-i18n Support.html">i18n Support</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#immediateEditStyle">immediateEditStyle</a></li><li><a href="global.html#styleText">styleText</a></li></ul></div><div class="category"><h2>Basemap</h2><h3>Components</h3><ul><li><a href="BasemapBingMaps.html">BasemapBingMaps</a></li><li><a href="BasemapBlankWhite.html">BasemapBlankWhite</a></li><li><a href="BasemapContainer.html">BasemapContainer</a></li><li><a href="BasemapManager.html">BasemapManager</a></li><li><a href="BasemapOpenStreetMap.html">BasemapOpenStreetMap</a></li><li><a href="BasemapStamenTerrain.html">BasemapStamenTerrain</a></li><li><a href="BasemapStamenTonerDark.html">BasemapStamenTonerDark</a></li><li><a href="BasemapStamenTonerLite.html">BasemapStamenTonerLite</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#loadBasemapLayer">loadBasemapLayer</a></li></ul></div><div class="category"><h2>Classes</h2><h3>Utils</h3><ul><li><a href="global.html#VectorLayer">VectorLayer</a></li><li><a href="global.html#VectorTileLayer">VectorTileLayer</a></li></ul></div><div class="category"><h2>ContextMenu</h2><h3>Components</h3><ul><li><a href="ContextMenu.html">ContextMenu</a></li><li><a href="ContextMenuCoords.html">ContextMenuCoords</a></li><li><a href="ContextMenuListItem.html">ContextMenuListItem</a></li></ul></div><div class="category"><h2>Controls</h2><h3>Components</h3><ul><li><a href="Compass.html">Compass</a></li><li><a href="ControlGroup.html">ControlGroup</a></li><li><a href="ControlGroupButton.html">ControlGroupButton</a></li><li><a href="Controls.html">Controls</a></li><li><a href="CurrentLocation.html">CurrentLocation</a></li><li><a href="ZoomControls.html">ZoomControls</a></li><li><a href="ZoomIn.html">ZoomIn</a></li><li><a href="ZoomOut.html">ZoomOut</a></li></ul></div><div class="category"><h2>DataLayers</h2><h3>Utils</h3><ul><li><a href="global.html#loadDataLayer">loadDataLayer</a></li></ul></div><div class="category"><h2>Draw</h2><h3>Components</h3><ul><li><a href="Draw.html">Draw</a></li><li><a href="DrawBox.html">DrawBox</a></li><li><a href="DrawCircle.html">DrawCircle</a></li><li><a href="DrawContainer.html">DrawContainer</a></li><li><a href="DrawFreehand.html">DrawFreehand</a></li><li><a href="DrawLine.html">DrawLine</a></li><li><a href="DrawPin.html">DrawPin</a></li><li><a href="DrawPoint.html">DrawPoint</a></li><li><a href="DrawPolygon.html">DrawPolygon</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#getStyledFeatures">getStyledFeatures</a></li><li><a href="global.html#styleText">styleText</a></li></ul></div><div class="category"><h2>FeatureEditor</h2><h3>Components</h3><ul><li><a href="FeatureEditor.html">FeatureEditor</a></li></ul></div><div class="category"><h2>GoogleDirections</h2><h3>Components</h3><ul><li><a href="GoogleDirections.html">GoogleDirections</a></li></ul></div><div class="category"><h2>GooglePlacesSearch</h2><h3>Components</h3><ul><li><a href="GooglePlacesSearch.html">GooglePlacesSearch</a></li></ul></div><div class="category"><h2>Heatmap</h2><h3>Components</h3><ul><li><a href="HeatmapControls.html">HeatmapControls</a></li></ul></div><div class="category"><h2>LayerPanel</h2><h3>Components</h3><ul><li><a href="LayerPanel.html">LayerPanel</a></li><li><a href="LayerPanelActionDuplicate.html">LayerPanelActionDuplicate</a></li><li><a href="LayerPanelActionExport.html">LayerPanelActionExport</a></li><li><a href="LayerPanelActionExtent.html">LayerPanelActionExtent</a></li><li><a href="LayerPanelActionHeatmap.html">LayerPanelActionHeatmap</a></li><li><a href="LayerPanelActionImport.html">LayerPanelActionImport</a></li><li><a href="LayerPanelActionMerge.html">LayerPanelActionMerge</a></li><li><a href="LayerPanelActionMergeFeatures.html">LayerPanelActionMergeFeatures</a></li><li><a href="LayerPanelActionOpacity.html">LayerPanelActionOpacity</a></li><li><a href="LayerPanelActionRemove.html">LayerPanelActionRemove</a></li><li><a href="LayerPanelActions.html">LayerPanelActions</a></li><li><a href="LayerPanelBase.html">LayerPanelBase</a></li><li><a href="LayerPanelCheckbox.html">LayerPanelCheckbox</a></li><li><a href="LayerPanelContent.html">LayerPanelContent</a></li><li><a href="LayerPanelHeader.html">LayerPanelHeader</a></li><li><a href="LayerPanelLayersPage.html">LayerPanelLayersPage</a></li><li><a href="LayerPanelList.html">LayerPanelList</a></li><li><a href="LayerPanelListItem.html">LayerPanelListItem</a></li><li><a href="LayerPanelMenu.html">LayerPanelMenu</a></li><li><a href="LayerPanelPage.html">LayerPanelPage</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#addHeatmapLayer">addHeatmapLayer</a></li><li><a href="global.html#addVectorLayer">addVectorLayer</a></li><li><a href="global.html#convertFileToFeatures">convertFileToFeatures</a></li><li><a href="global.html#convertFileToLayer">convertFileToLayer</a></li><li><a href="global.html#exportFeatures">exportFeatures</a></li><li><a href="global.html#mergeLayerFeatures">mergeLayerFeatures</a></li></ul></div><div class="category"><h2>LayerStyler</h2><h3>Components</h3><ul><li><a href="LayerStyler.html">LayerStyler</a></li></ul></div><div class="category"><h2>Map</h2><h3>Components</h3><ul><li><a href="Map.html">Map</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#addSelectInteraction">addSelectInteraction</a></li><li><a href="global.html#centerAndZoom">centerAndZoom</a></li><li><a href="global.html#convertXYtoLatLong">convertXYtoLatLong</a></li><li><a href="global.html#createMap">createMap</a></li><li><a href="global.html#createSelectInteraction">createSelectInteraction</a></li><li><a href="global.html#getExtentForFeatures">getExtentForFeatures</a></li><li><a href="global.html#getSelectInteraction">getSelectInteraction</a></li><li><a href="global.html#setMapExtent">setMapExtent</a></li><li><a href="global.html#updateMapFromUrl">updateMapFromUrl</a></li><li><a href="global.html#updateUrlFromMap">updateUrlFromMap</a></li></ul></div><div class="category"><h2>MultiMap</h2><h3>Components</h3><ul><li><a href="MultiMapManager.html">MultiMapManager</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#syncViewEvents">syncViewEvents</a></li></ul></div><div class="category"><h2>PDF</h2><h3>Utils</h3><ul><li><a href="global.html#convertSvgToPDFTemplate">convertSvgToPDFTemplate</a></li><li><a href="global.html#printPDFTemplate">printPDFTemplate</a></li></ul></div><div class="category"><h2>Popup</h2><h3>Components</h3><ul><li><a href="Popup.html">Popup</a></li><li><a href="PopupActionGroup.html">PopupActionGroup</a></li><li><a href="PopupActionItem.html">PopupActionItem</a></li><li><a href="PopupActionLink.html">PopupActionLink</a></li><li><a href="PopupBase.html">PopupBase</a></li><li><a href="PopupDataList.html">PopupDataList</a></li><li><a href="PopupDefaultInsert.html">PopupDefaultInsert</a></li><li><a href="PopupDefaultPage.html">PopupDefaultPage</a></li><li><a href="PopupPageLayout.html">PopupPageLayout</a></li><li><a href="PopupPageLayoutChild.html">PopupPageLayoutChild</a></li><li><a href="PopupTabs.html">PopupTabs</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#addMovementListener">addMovementListener</a></li><li><a href="global.html#calculateViewPadding">calculateViewPadding</a></li><li><a href="global.html#getLayersAndFeaturesForEvent">getLayersAndFeaturesForEvent</a></li><li><a href="global.html#getPixelValue">getPixelValue</a></li><li><a href="global.html#getPopupPositionFromFeatures">getPopupPositionFromFeatures</a></li><li><a href="global.html#removeMovementListener">removeMovementListener</a></li><li><a href="global.html#sanitizeProperties">sanitizeProperties</a></li></ul></div><div class="category"><h2>PopupActionCopyWkt</h2><h3>Components</h3><ul><li><a href="PopupActionCopyWkt.html">PopupActionCopyWkt</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#convertFeatureToWkt">convertFeatureToWkt</a></li><li><a href="global.html#copyTextToClipboard">copyTextToClipboard</a></li><li><a href="global.html#copyWktToClipbard">copyWktToClipbard</a></li></ul></div><div class="category"><h2>PopupActionGoogleMaps</h2><h3>Components</h3><ul><li><a href="PopupActionGoogleMaps.html">PopupActionGoogleMaps</a></li></ul></div><div class="category"><h2>Project</h2><h3>Components</h3><ul><li><a href="ProjectMenu.html">ProjectMenu</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#createProject">createProject</a></li><li><a href="global.html#loadProject">loadProject</a></li></ul></div><div class="category"><h2>Provider</h2><h3>Components</h3><ul><li><a href="Provider.html">Provider</a></li></ul><h3>Utils</h3><ul><li><a href="global.html#connectToContext">connectToContext</a></li></ul></div><div class="category"><h2>TabbedPanel</h2><h3>Components</h3><ul><li><a href="TabbedPanel.html">TabbedPanel</a></li></ul></div><div class="category"><h2>TimeSlider</h2><h3>Components</h3><ul><li><a href="TimeSlider.html">TimeSlider</a></li><li><a href="TimeSliderBase.html">TimeSliderBase</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop" id="main-content-wrapper">
                <div class="content">
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { createRef, PureComponent } from 'react'
import PropTypes from 'prop-types'
import { Virtuoso } from 'react-virtuoso'
import LayerPanelPage from 'LayerPanel/LayerPanelPage'
import LayerPanelContent from 'LayerPanel/LayerPanelContent'
import LayerPanelList from 'LayerPanel/LayerPanelList'
import LayerPanelListItem from 'LayerPanel/LayerPanelListItem'
import LayerPanelCheckbox from 'LayerPanel/LayerPanelCheckbox'
import LayerPanelExpandableList from 'LayerPanel/_LayerPanelExpandableList'
import LayerPanelActions from 'LayerPanel/LayerPanelActions'
import { ListItem, ListItemText } from 'LayerPanel/LayerPanelListItem/styled'
import { ListItemSecondaryAction } from './styled'
import Collapse from '@material-ui/core/Collapse'
import MoreVertIcon from '@material-ui/icons/MoreVert'
import LayersIcon from '@material-ui/icons/Layers'
import olStroke from 'ol/style/Stroke'
import olFill from 'ol/style/Fill'
import olCircle from 'ol/style/Circle'
import ugh from 'ugh'

import { addSelectInteraction } from 'Map'

import MoreHorizIcon from '@material-ui/icons/MoreHoriz'

import LayerPanelActionOpacity from 'LayerPanel/LayerPanelActionOpacity'
import LayerPanelActionRemove from 'LayerPanel/LayerPanelActionRemove'
import LayerPanelActionExtent from 'LayerPanel/LayerPanelActionExtent'
import LayerPanelActionHeatmap from 'LayerPanel/LayerPanelActionHeatmap'
import LayerPanelActionDuplicate from 'LayerPanel/LayerPanelActionDuplicate'

import TextField from '@material-ui/core/TextField'

import olLayerVector from 'ol/layer/Vector'
import olSourceVector from 'ol/source/Vector'
import olStyleStyle from 'ol/style/Style'

import LayerPanelActionImport from 'LayerPanel/LayerPanelActionImport'
import LayerPanelActionExport from 'LayerPanel/LayerPanelActionExport'
import LayerPanelActionMerge from 'LayerPanel/LayerPanelActionMerge'
import LayerPanelActionMergeFeatures from 'LayerPanel/LayerPanelActionMergeFeatures'

import isEqual from 'lodash.isequal'
import { connectToContext } from 'Provider'
import { convertFileToFeatures } from 'LayerPanel/LayerPanelActionImport/utils'
import VectorLayer from 'classes/VectorLayer'

const INDETERMINATE = 'indeterminate'

/**
 * @component
 * @category LayerPanel
 * @since 0.5.0
 */
class LayerPanelLayersPage extends PureComponent {
  constructor (props) {
    super(props)

    this.state = {
      layers: [],
      masterCheckboxVisibility: true,
      featureListeners: [],
      filterText: '',
      expandedLayers: []
    }

    this.virtuoso = createRef(null)
    this.scrollIndex = createRef(0)
  }

  initializeSelect = map => {
    const { setHoverStyle, disableHover } = this.props

    if (disableHover) return // opt-out

    const { stroke = 'red', fill = '#ffffff', color = 'red' } = setHoverStyle()

    const style = new olStyleStyle({
      stroke: new olStroke({
        color: stroke,
        width: 3
      }),
      image: new olCircle({
        radius: 5,
        fill: new olFill({
          color: fill
        }),
        stroke: new olStroke({
          color: color,
          width: 2
        })
      })
    })

    const { select } = addSelectInteraction(map, '_ol_kit_layer_panel_hover', { style: [style] })

    this.selectInteraction = select
  }

  selectFeatures = features => {
    const { disableHover } = this.props

    if (disableHover) return
    // clear the previously selected feature before adding newly selected feature so only one feature is "selected" at a time
    this.selectInteraction.getFeatures().clear()

    if (features?.length) {
      features.forEach(feature => {
        if (feature.get('_ol_kit_feature_visibility')) {
          this.selectInteraction.getFeatures().push(feature)
        }
      })
    }
  }

  componentDidMount = () => {
    const { map, layerFilter } = this.props
    const layers = map.getLayers()
    const handleMapChange = (e, add) => {
      const filteredLayers = layerFilter(layers.getArray())

      // if we're adding a layer we want to add it to the top of the list but not update any of the other layers zIndex
      if (add) {
        const safeFilteredLayersLength = filteredLayers ? filteredLayers.length - 1 : 0

        filteredLayers[safeFilteredLayersLength] &amp;&amp; filteredLayers[safeFilteredLayersLength].setZIndex(filteredLayers.length) // eslint-disable-line
      }

      this.setState({ layers: filteredLayers.sort(this.zIndexSort) }, this.bindFeatureListeners)
    }

    // we call this to re-retrieve the layers on mount
    handleMapChange()
    this.initializeSelect(map)
    // we call this to re-adjust the master checkbox as needed
    this.handleMasterCheckbox()

    // bind the event listeners
    this.onAddKey = layers.on('add', (e) => handleMapChange(e, true))
    this.onRemoveKey = layers.on('remove', handleMapChange)
  }

  componentWillUnmount = () => {
    const { map } = this.props
    const layers = map.getLayers()

    // unbind the listeners
    layers.unset(this.onAddKey)
    layers.unset(this.onRemoveKey)
    this.removeFeatureListeners()
  }

  componentDidUpdate (prevProps, prevState) {
    // if there were previous layers but then removed to none set layers to empty and hanlde the mastercheckbox
    if (prevState.layers.length > 0 &amp;&amp; this.state.layers.length === 0) {
      this.setState({ layers: [] })
      this.handleMasterCheckbox()
      // if you are adding layers when the prevlayers was 0 then the mastercheckbox needs to be dealt with
    } else if (prevState.layers.length === 0 &amp;&amp; this.state.layers.length > 0) {
      this.handleMasterCheckbox()
    }
    const index = this.scrollIndex.current
    setTimeout(() => {
      /**
       * this is absurd but literally what the author of the lib suggested
       * to keep the scroll index updated after a rerender (checkbox click)
       * https://github.com/petyosi/react-virtuoso/issues/323#issuecomment-810127282
       */
      this.virtuoso.current?.scrollToIndex({
        index,
        align: 'start',
        behavior: 'auto'
      })
    }, 0)
  }

  bindFeatureListeners = () => {
    const { layers = [] } = this.state

    const featureListeners = layers.reduce((listeners = [], layer) => {
      if (this.props.shouldHideFeatures(layer)) return

      const isVectorLayer = this.isValidVectorLayer(layer)
      const canGetSource = typeof layer.getSource === 'function'
      const hasVectorSource = canGetSource &amp;&amp; layer.getSource() instanceof olSourceVector

      if (!isVectorLayer &amp;&amp; !hasVectorSource) return [...listeners]

      const source = layer.getSource()
      const addFeature = source.on('addfeature', this.handleFeatureChange)
      const removeFeature = source.on('removefeature', this.handleFeatureChange)

      return [...listeners, [source, addFeature], [source, removeFeature]]
    }, [])

    this.setState({ featureListeners })
  }

  removeFeatureListeners = () => {
    const { featureListeners = [] } = this.state

    Array.isArray(featureListeners) &amp;&amp; featureListeners.forEach(([source, listener]) => {
      source.unset(listener)
    })
  }

  handleFeatureChange = () => {
    this.forceUpdate()
  }

  getVisibleLayers = () => {
    return this.state.layers.filter(layer => layer.getVisible())
  }

  showLayers = (layers) => {
    return layers.map(layer => {
      layer.setVisible(true)

      return layer
    })
  }

  hideLayers = (layers) => {
    return layers.map(layer => {
      layer.setVisible(false)

      return layer
    })
  }

  setVisibilityForAllLayers = (_, visibility) => {
    const { layers } = this.state
    const updatedLayers = visibility ? this.showLayers(layers) : this.hideLayers(layers)

    layers.forEach(layer => this.setVisibilityForAllFeaturesOfLayer(layer, visibility))
    this.setState({ layers: updatedLayers }, () => this.handleMasterCheckbox())
  }

  getFeaturesForLayer = (layer) => {
    if (!this.isValidVectorLayer(layer)) return []
    if (this.props.shouldHideFeatures(layer)) return []

    return layer.getSource().getFeatures().map(feature => {
      const isVisible = feature.get('_ol_kit_feature_visibility') === undefined ? true : feature.get('_ol_kit_feature_visibility')
      const olkitStyle = feature.get('_ol_kit_feature_style') || feature.getStyle()
      const featureOriginalStyle = isEqual(olkitStyle, new olStyleStyle(null)) ? undefined : olkitStyle
      const featureStyle = isVisible ? featureOriginalStyle : new olStyleStyle()

      feature.set('_ol_kit_feature_visibility', isVisible)
      if (feature.get('_ol_kit_feature_style') === undefined) feature.set('_ol_kit_feature_style', featureStyle)
      feature.setStyle(featureStyle)

      return feature
    }).filter((feature) => {
      const name = feature.get('name')

      return !this.props.enableFilter || !this.state.filterText || !name
        ? true : name.toLowerCase().includes(this.state.filterText.toLowerCase())
    })
  }

  getVisibleFeaturesForLayer = (layer) => {
    return (this.isValidVectorLayer(layer))
      ? layer.getSource().getFeatures().filter(feature => feature.get('_ol_kit_feature_visibility')) : []
  }

  setVisibilityForAllFeaturesOfLayer = (layer, visibility) => {
    if (this.isValidVectorLayer(layer)) {
      layer.getSource().getFeatures().map(feature => {
        feature.set('_ol_kit_feature_visibility', visibility)
        feature.setStyle(feature.get('_ol_kit_feature_style'))
      })
    }
  }

  // remove visible features on the layer
  removeFeaturesForLayer = layer => {
    const removeFeatures = this.getVisibleFeaturesForLayer(layer)

    removeFeatures.map(feature => layer.getSource().removeFeature(feature))
    this.handleLayerCheckbox(layer)
  }

  // this is where all of the checkbox magic happens...
  handleMasterCheckbox = () => {
    const visibleLayers = this.getVisibleLayers().length
    const allLayers = this.state.layers.length
    const indeterminateLayers = this.getVisibleLayers().filter(layer => layer.get('_ol_kit_layerpanel_visibility') === INDETERMINATE).length

    const masterCheckboxState = indeterminateLayers ? INDETERMINATE : visibleLayers === allLayers &amp;&amp; allLayers > 0 ? true : visibleLayers > 0 ? INDETERMINATE : false // eslint-disable-line

    this.setState({ masterCheckboxVisibility: masterCheckboxState })
    this.forceUpdate()
  }

  handleLayerCheckbox = (layer, layerCheckboxClick = false) => {
    const visibleFeatures = this.getVisibleFeaturesForLayer(layer).length
    const totalFeatures = this.isValidVectorLayer(layer) ? layer.getSource().getFeatures().length : 0
    const layerVisibility = visibleFeatures === totalFeatures &amp;&amp; totalFeatures > 0 ? true : visibleFeatures > 0 ? INDETERMINATE : false // eslint-disable-line

    if (layerCheckboxClick &amp;&amp; layerVisibility === INDETERMINATE) {
      layer.setVisible(true)
      layer.set('_ol_kit_layerpanel_visibility', true)
    } else if (layerCheckboxClick) {
      const lv = !layer.getVisible()

      layer.setVisible(lv)
      layer.set('_ol_kit_layerpanel_visibility', lv)
    } else {
      layer.setVisible(layerVisibility === INDETERMINATE ? true : layerVisibility)
      layer.set('_ol_kit_layerpanel_visibility', layerVisibility)
    }

    if (layerCheckboxClick) this.setVisibilityForAllFeaturesOfLayer(layer, layer.getVisible())

    this.handleMasterCheckbox()
  }

  handleFeatureCheckbox = (layer, feature) => {
    feature.set('_ol_kit_feature_visibility', !feature.get('_ol_kit_feature_visibility'))
    this.handleLayerCheckbox(layer)
  }

  handleVisibility = (event, layer) => {
    event.stopPropagation()

    this.handleMasterCheckbox()
    this.handleLayerCheckbox(layer, true)
  }

  handleFilter = (filterText) => {
    this.setState({ filterText })
  }

  isValidVectorLayer = (layer) => {
    return (layer instanceof olLayerVector || (layer &amp;&amp; layer.isVectorLayer))
  }

  handleExpandedLayer = (layer) => {
    const clonedExpandedLayers = [...this.state.expandedLayers]
    const index = clonedExpandedLayers.indexOf(layer.ol_uid)

    index > -1 ? clonedExpandedLayers.splice(index, 1) : clonedExpandedLayers.push(layer.ol_uid)

    this.setState({ expandedLayers: clonedExpandedLayers })
  }

  // highest zIndex should be at the front of the list (reverse order of array index)
  zIndexSort = (a, b) => b.getZIndex() - a.getZIndex()

  reorderLayers = (reorderedLayers) => {
    // apply the z-index changes down to all layers
    reorderedLayers.map((l, i) => l.setZIndex(reorderedLayers.length - i))

    this.setState({ layers: reorderedLayers })
  }

  onFileImport = file => {
    const { map, onFileImport } = this.props

    // otherwise, add them to the map ourselves
    convertFileToFeatures(file, map).then(({ features, name }) => {
      // if a callback to handle imported features is passed, IAs handle add them to the map
      if (onFileImport) {
        features.forEach(({ featureArray, fileName }) => {
          onFileImport(featureArray, `${name}(${fileName})`)
        })
      // if no onFileImport prop is passed, create a layer, add it and center/zoom the map
      } else {
        features.forEach(({ featureArray, fileName }) => {
          const source = new olSourceVector({ features: featureArray })
          const layer = new VectorLayer({ title: `${name}(${fileName})`, source })

          map.addLayer(layer)
          map.getView().fit(source.getExtent(), map.getSize())
        })
      }
    }).catch(ugh.error)
  }

  handleRangeChange = visibleRange => {
    this.scrollIndex.current = visibleRange.startIndex
  }

  renderFeatureRow = (index, data) => {
    const { feature, layer } = data
    const { handleFeatureDoubleClick, translations } = this.props
  
    return (
      &lt;ListItem data-testid={`LayerPanel.feature${index}`} key={index} onDoubleClick={() => handleFeatureDoubleClick(feature)}>
        &lt;LayerPanelCheckbox
          handleClick={(event) => this.handleFeatureCheckbox(layer, feature, event)}
          checkboxState={feature.get('_ol_kit_feature_visibility')} />
        &lt;ListItemText inset={false} primary={feature.get('name') || `${translations['_ol_kit.LayerPanelListItem.feature']} ${index + 1}`} />
      &lt;/ListItem>
    )
  }

  formatFeatureRows = (features, layer) => (
    Array.from({ length: features.length }, 
      (_, index) => ({
        feature: features[index],
        layer,
      })
    )
  )

  render () {
    const {
      translations, layerFilter, handleLayerDoubleClick, disableDrag, tabIcon, onLayerRemoved,
      onLayerReorder, enableFilter, getMenuItemsForLayer, shouldAllowLayerRemoval, map, onExportFeatures, onMergeLayers, onCreateHeatmap, expandedHeight
    } = this.props
    const { layers, masterCheckboxVisibility, filterText, expandedLayers } = this.state
    const isExpandedLayer = (layer) => !!expandedLayers.find(expandedLayerId => expandedLayerId === layer.ol_uid)

    return (
      &lt;LayerPanelPage tabIcon={tabIcon}>
        &lt;TextField
          id='feature-filter-input'
          label={translations['_ol_kit.LayerPanelLayersPage.filterText']}
          type='text'
          style={{ margin: '8px', display: enableFilter ? 'block' : 'none' }}
          fullWidth
          value={filterText}
          onChange={(e) => this.handleFilter(e.target.value)} />
        &lt;LayerPanelContent padding={enableFilter ? '0px 15px 58px 15px !important' : '0px 15px'}>
          &lt;LayerPanelListItem
            id='all_layers'
            title={translations['_ol_kit.LayerPanelLayersPage.title']}
            translations={translations} >
            &lt;LayerPanelCheckbox
              checkboxState={masterCheckboxVisibility}
              handleClick={this.setVisibilityForAllLayers} />
            &lt;ListItemText primary={'All Layers'} />
            &lt;ListItemSecondaryAction style={{ right: '0px !important' }}>
              &lt;LayerPanelActions
                icon={&lt;MoreHorizIcon data-testid='LayerPanel.masterActionsIcon' />}
                translations={translations}
                layers={layers}
                map={map}>
                &lt;LayerPanelActionRemove
                  removeFeaturesForLayer={this.removeFeaturesForLayer}
                  shouldAllowLayerRemoval={shouldAllowLayerRemoval}
                  onLayerRemoved={onLayerRemoved} />
                &lt;LayerPanelActionImport handleImport={this.onFileImport} />
                &lt;LayerPanelActionExport onExportFeatures={onExportFeatures} />
                &lt;LayerPanelActionMerge onMergeLayers={onMergeLayers} />
              &lt;/LayerPanelActions>
            &lt;/ListItemSecondaryAction>
          &lt;/LayerPanelListItem>
          &lt;LayerPanelList
            disableDrag={disableDrag}
            onSort={this.zIndexSort}
            onReorderedItems={this.reorderLayers}
            items={layers}
            onLayerReorder={onLayerReorder} >
            {layerFilter(layers).filter((layer) => {
              const filteredFeatures = this.getFeaturesForLayer(layer)

              return !enableFilter ||
                !(layer instanceof olLayerVector) ||
                this.props.shouldHideFeatures(layer) ? true : filteredFeatures?.length
            }).map((layer, i) => {
              const features = this.getFeaturesForLayer(layer)
              const isExpanded = isExpandedLayer(layer)
              const data = this.formatFeatureRows(features, layer)
              const initialItemCount = data.length > this.props.initialItemCount ? this.props.initialItemCount : data.length

              return (
                &lt;div key={i}
                  onMouseEnter={() => this.selectFeatures(features)}
                  onMouseLeave={() => this.selectFeatures([])}>
                  &lt;LayerPanelListItem handleDoubleClick={() => { handleLayerDoubleClick(layer) }}>
                    {&lt;LayerPanelCheckbox
                      checkboxState={!layer ? null : layer.get('_ol_kit_layerpanel_visibility') || layer.getVisible()}
                      handleClick={(e) => this.handleVisibility(e, layer)} />}
                    {&lt;LayerPanelExpandableList
                      show={!!features}
                      open={isExpanded}
                      handleClick={() => this.handleExpandedLayer(layer)} />}
                    &lt;ListItemText primary={layer.get('title') || 'Untitled Layer'} />
                    &lt;ListItemSecondaryAction style={{ right: '0px !important' }}>
                      &lt;LayerPanelActions
                        icon={&lt;MoreVertIcon data-testid='LayerPanel.actionsIcon' />}
                        translations={translations}
                        layer={layer}
                        map={map} >
                        {getMenuItemsForLayer(layer) ||
                        [&lt;LayerPanelActionRemove key='removeLayer' shouldAllowLayerRemoval={shouldAllowLayerRemoval} />,
                          &lt;LayerPanelActionExtent key='gotoExtent' />,
                          &lt;LayerPanelActionDuplicate key='duplicateLayer'/>,
                          &lt;LayerPanelActionMergeFeatures key='mergeFeatures' />,
                          &lt;LayerPanelActionHeatmap key='heatmap' layer={layer} onCreateHeatmap={onCreateHeatmap} />,
                          &lt;LayerPanelActionOpacity key='layerOpacity' />]}
                      &lt;/LayerPanelActions>
                    &lt;/ListItemSecondaryAction>
                  &lt;/LayerPanelListItem>
                  {isExpanded
                    ? &lt;Collapse in={isExpanded} timeout='auto'>
                        &lt;Virtuoso
                          style={{ paddingLeft: '36px', height: features.length * 52 > expandedHeight ? expandedHeight : features.length * 52 }}
                          data={data}
                          ref={this.virtuoso}
                          itemContent={this.renderFeatureRow}
                          rangeChanged={this.handleRangeChange}
                          initialItemCount={initialItemCount}
                        />
                      &lt;/Collapse>
                    : null
                  }
                &lt;/div>
              )
            })}
          &lt;/LayerPanelList>
        &lt;/LayerPanelContent>
      &lt;/LayerPanelPage>
    )
  }
}

LayerPanelLayersPage.defaultProps = {
  handleFeatureDoubleClick: () => {},
  handleLayerDoubleClick: () => {},
  layerFilter: (layers) => layers.filter(layer => !layer.get('_ol_kit_basemap') &amp;&amp; layer.get('name') !== 'unselectable'),
  shouldHideFeatures: (layer) => false,
  shouldAllowLayerRemoval: (layer) => true,
  getMenuItemsForLayer: () => false,
  onCreateHeatmap: () => {},
  tabIcon: &lt;LayersIcon />,
  setHoverStyle: () => ({ color: 'red', fill: '#ffffff', stroke: 'red' }),
  disableHover: false,
  initialItemCount: 6,
  expandedHeight: 300
}

LayerPanelLayersPage.propTypes = {
  /** Object with key/value pairs for translated strings */
  translations: PropTypes.object,

  /** An Openlayer map from which the layer panel will derive its layers  */
  map: PropTypes.object,

  /** The icon for the page shown in the left side of the layer panel */
  tabIcon: PropTypes.node,

  /** A function which takes in layers &amp; returns a subset of those layers (useful to "hide" certain layers) */
  layerFilter: PropTypes.func,

  /** A boolean which turns on/off filtering of features in the layer panel page */
  enableFilter: PropTypes.bool,

  /** A callback function passed the features imported from 'kmz', 'kml', 'geojson', 'wkt', 'csv', 'zip', and 'json' file types */
  onFileImport: PropTypes.func,

  /** A callback function fired when a feature list item is double clicked */
  handleFeatureDoubleClick: PropTypes.func,

  /** A callback function fired when a feature list header is double clicked */
  handleLayerDoubleClick: PropTypes.func,

  /** An array of components to be rendered in the LayerPanelHeader action menu */
  customActions: PropTypes.array,

  /** A callback function to determine if a given layer's features should be kept hidden from the panel page display */
  shouldHideFeatures: PropTypes.func,

  /** A callback function to determine if a given layer should be allowed to be removed from the panel page display */
  shouldAllowLayerRemoval: PropTypes.func,

  /** A callback fired when a new heatmap is created */
  onCreateHeatmap: PropTypes.func,

  /** A callback function that returns the file type and the features that are being exported */
  onExportFeatures: PropTypes.func,

  /** A callback fired when layers are merged */
  onMergeLayers: PropTypes.func,

  /** A callback function to set custom Menu Items for a specific layer. Should recieve an array of `@material-ui/core/MenuItem` */
  getMenuItemsForLayer: PropTypes.func,

  /** A boolean to disable the drag event on the LayerPanelList */
  disableDrag: PropTypes.bool,

  /** A callback function to inform when layers are reordered */
  onLayerReorder: PropTypes.func,

  /** A callback function to inform when a layer is removed */
  onLayerRemoved: PropTypes.func,
  /** Truthy value will disable hover */
  disableHover: PropTypes.bool,

  /** Pass fill, stroke, and color hover style values */
  setHoverStyle: PropTypes.func,

  /** Set initial item count to render feature rows in virtualized list */
  initialItemCount: PropTypes.number,

  /** Set max height for feature scroll area (number equates to pixels) */
  expandedHeight: PropTypes.number
}

export default connectToContext(LayerPanelLayersPage)
</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>
<footer class="footer">
    <div class="content has-text-centered">
        <div style="margin: 0 auto; text-align: center; background: white; margin: 30px 0;">
            <a href="https://www.cropscience.bayer.com" target="_blank">
                <img src="static/bayer-logo.png" width="200px" />
            </a>
            <div>&copy; 2020 Bayer Crop Science; All Rights Reserved. <br />
            <a style="color: #a2a2a2" target="_blank" href="https://bayer.talentnet.community/jobs/881c8317-33b7-435f-9410-359b1b925322"> Geospatial Developer Career Opportunities </a>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js" integrity="sha256-vrn14y7WH7zgEElyQqm2uCGSQrX/xjYDjniRUQx3NyU=" crossorigin="anonymous"></script>
<script src="https://unpkg.com/sticky-sidebar/dist/sticky-sidebar.min.js"></script>
<script src="scripts/app.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
